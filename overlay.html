<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; script-src 'self' 'unsafe-inline'">
  <title>Overlay</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { margin: 0; background: transparent; }
    .drag-region { -webkit-app-region: drag; position: absolute; inset: 0; cursor: move; }
    .no-drag { -webkit-app-region: no-drag; }
  </style>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const timeEl = document.getElementById('overlayTime');
      const modeEl = document.getElementById('overlayMode');
      const progressEl = document.getElementById('overlayProgress');
      if (window.electronAPI && window.electronAPI.onTimerUpdate) {
        window.electronAPI.onTimerUpdate((state) => {
          console.log('overlay received update', state);
          if (timeEl) timeEl.textContent = formatTime(state.currentTime);
          if (modeEl) modeEl.textContent = modeLabel(state.currentMode);
          if (progressEl && state.totalTime > 0) {
            const progress = ((state.totalTime - state.currentTime) / state.totalTime) * 283;
            progressEl.setAttribute('stroke-dashoffset', String(283 - progress));
            const color = state.currentMode === 'work' ? '#67d7fd' : (state.currentMode === 'break' ? '#7bed9f' : '#ffa502');
            progressEl.setAttribute('stroke', color);
          }
        });
      }
      function formatTime(sec){
        const m = Math.floor(sec / 60).toString().padStart(2,'0');
        const s = (sec % 60).toString().padStart(2,'0');
        return `${m}:${s}`;
      }
      function modeLabel(m){
        return m === 'work' ? 'Work' : (m === 'break' ? 'Short Break' : 'Long Break');
      }
    });
  </script>
  </head>
<body>
  <div class="overlay-root">
    <div class="drag-region"></div>
    <div class="no-drag">
      <svg class="timer-svg" viewBox="0 0 100 100" width="120" height="120">
        <circle class="timer-bg" cx="50" cy="50" r="45" stroke="rgba(255,255,255,0.25)" stroke-width="8" fill="none"></circle>
        <circle id="overlayProgress" cx="50" cy="50" r="45" stroke="#67d7fd" stroke-width="8" fill="none" stroke-linecap="round" transform="rotate(-90 50 50)" stroke-dasharray="283" stroke-dashoffset="283"></circle>
      </svg>
      <div id="overlayTime" class="overlay-time" style="text-align:center; margin-top:-90px;">25:00</div>
      <div id="overlayMode" class="overlay-mode" style="text-align:center; margin-top:6px;">Work</div>
    </div>
  </div>
</body>
</html>


